<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š íˆ¬ì ì²œì¬ë¥¼ ì°¾ì•„ë¼! - ì‹¤ì‹œê°„ ìˆœìœ„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 3.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.5em;
            color: #666;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center;
        }

        .stat-label {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .ranking-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .section-title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
            color: #333;
        }

        .ranking-grid {
            display: grid;
            gap: 15px;
        }

        .rank-card {
            display: grid;
            grid-template-columns: 100px 200px 1fr 150px 150px 150px 150px;
            align-items: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
        }

        .rank-card.moving-up {
            animation: slideUp 0.5s ease-out;
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
        }

        .rank-card.moving-down {
            animation: slideDown 0.5s ease-out;
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
        }

        @keyframes slideUp {
            0% { transform: translateY(50px); opacity: 0.5; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideDown {
            0% { transform: translateY(-50px); opacity: 0.5; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .rank-card.rank-1 {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }

        .rank-card.rank-2 {
            background: linear-gradient(135deg, #E8E8E8 0%, #C0C0C0 100%);
        }

        .rank-card.rank-3 {
            background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
        }

        .rank-badge {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            position: relative;
        }

        .rank-1 .rank-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            animation: pulse-gold 2s infinite;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        }

        @keyframes pulse-gold {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .rank-2 .rank-badge {
            background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
        }

        .rank-3 .rank-badge {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
        }

        .rank-badge.other {
            background: linear-gradient(135deg, #667eea, #764ba2);
            font-size: 2em;
        }

        .rank-change-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            animation: bounce 0.5s;
        }

        .rank-up {
            background: #27ae60;
            color: white;
        }

        .rank-down {
            background: #e74c3c;
            color: white;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        .student-name {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .rank-1 .student-name, .rank-2 .student-name, .rank-3 .student-name {
            color: white;
        }

        .student-stats {
            display: grid;
            grid-template-columns: subgrid;
            grid-column: 4 / -1;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .rank-1 .stat-item-label, .rank-2 .stat-item-label, .rank-3 .stat-item-label {
            color: rgba(255,255,255,0.8);
        }

        .stat-item-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .rank-1 .stat-item-value, .rank-2 .stat-item-value, .rank-3 .stat-item-value {
            color: white;
        }

        .return-positive {
            color: #e74c3c !important;
        }

        .return-negative {
            color: #3498db !important;
        }

        .no-data {
            text-align: center;
            padding: 60px;
            font-size: 1.5em;
            color: #999;
        }

        .refresh-indicator {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 1.1em;
        }

        .refresh-indicator.active {
            color: #27ae60;
            font-weight: bold;
        }

        @media (max-width: 1400px) {
            .rank-card {
                grid-template-columns: 80px 150px 1fr 120px 120px 120px 120px;
                padding: 15px;
            }
            
            .rank-badge {
                width: 60px;
                height: 60px;
                font-size: 2em;
            }
            
            .student-name {
                font-size: 1.5em;
            }
        }

        .credit {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 0.9em;
            color: #999;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        .reset-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            transition: all 0.3s;
            z-index: 1001;
        }

        .reset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .reset-button:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- ë¦¬ì…‹ ë²„íŠ¼ -->
    <button class="reset-button" onclick="resetAllData()">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>

    <div class="container">
        <div class="header">
            <h1>ğŸ† íˆ¬ì ì²œì¬ë¥¼ ì°¾ì•„ë¼! ğŸ†</h1>
            <p>ì‹¤ì‹œê°„ ìˆœìœ„</p>
        </div>

        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-label">ğŸ‘¥ ì°¸ì—¬ í•™ìƒ</div>
                <div class="stat-value" id="totalStudents">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ† ìµœê³  ìˆ˜ìµë¥ </div>
                <div class="stat-value" id="topReturn">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ’° í‰ê·  ìì‚°</div>
                <div class="stat-value" id="avgAssets">0ì›</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ“ˆ í‰ê·  ìˆ˜ìµë¥ </div>
                <div class="stat-value" id="avgReturn">0%</div>
            </div>
        </div>

        <div class="ranking-container">
            <div class="section-title">ğŸ“Š ì‹¤ì‹œê°„ ìˆœìœ„</div>
            
            <div class="ranking-grid" id="rankingGrid">
                <div class="no-data">
                    í•™ìƒë“¤ì´ ê²Œì„ì— ì°¸ì—¬í•˜ë©´ ì—¬ê¸°ì— ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤! ğŸ®
                </div>
            </div>

            <div class="refresh-indicator" id="refreshIndicator">
                ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ëŒ€ê¸° ì¤‘...
            </div>
        </div>
    </div>

    <!-- í¬ë ˆë”§ -->
    <div class="credit">Created by ê°€ì‚¬ë¬¸í•™ì´ˆ ìœ¤ì¤€ì² </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase ì„¤ì • (í•™ìƒìš©ê³¼ ë™ì¼í•˜ê²Œ ì…ë ¥)
        const firebaseConfig = {
  apiKey: "AIzaSyA3yFsHhQg4l_4_75zl6EKydB0ANiuNY8Y",
  authDomain: "stock-game-2025.firebaseapp.com",
  databaseURL: "https://stock-game-2025-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "stock-game-2025",
  storageBucket: "stock-game-2025.firebasestorage.app",
  messagingSenderId: "1006617048802",
  appId: "1:1006617048802:web:f34930b9618236520d90bb"
};

        // íš¨ê³¼ìŒ ì‹œìŠ¤í…œ
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playRankUpSound() {
            // ìˆœìœ„ ìƒìŠ¹ìŒ (ë„-ë¯¸-ì†”)
            playTone(523, 0.1);
            setTimeout(() => playTone(659, 0.1), 100);
            setTimeout(() => playTone(784, 0.15), 200);
        }

        function playRankDownSound() {
            // ìˆœìœ„ í•˜ë½ìŒ (ì†”-ë¯¸-ë„)
            playTone(784, 0.1);
            setTimeout(() => playTone(659, 0.1), 100);
            setTimeout(() => playTone(523, 0.15), 200);
        }

        function playTone(frequency, duration) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        let previousRankings = {};

        // Firebase ì´ˆê¸°í™”
        let database;
        try {
            const app = initializeApp(firebaseConfig);
            database = getDatabase(app);
            
            // ì „ì—­ ì ‘ê·¼ì„ ìœ„í•´ window ê°ì²´ì— ì €ì¥
            window.firebaseDB = database;
            window.firebaseRef = ref;
            window.firebaseRemove = remove;
            
            // ì‹¤ì‹œê°„ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ
            const studentsRef = ref(database, 'students');
            onValue(studentsRef, (snapshot) => {
                updateRankings(snapshot.val());
                updateRefreshIndicator();
            });
            
        } catch (error) {
            console.error('Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            showError('Firebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }

        function updateRankings(studentsData) {
            if (!studentsData) {
                document.getElementById('rankingGrid').innerHTML = `
                    <div class="no-data">
                        ì•„ì§ ì°¸ì—¬í•œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.<br>
                        í•™ìƒë“¤ì´ ê²Œì„ì„ ì‹œì‘í•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤! ğŸ®
                    </div>
                `;
                updateStats(null);
                return;
            }

            const studentsArray = Object.values(studentsData);
            studentsArray.sort((a, b) => b.totalAssets - a.totalAssets);

            // í†µê³„ ì—…ë°ì´íŠ¸
            updateStats(studentsArray);

            // ìˆœìœ„ ë³€ë™ ê°ì§€ ë° íš¨ê³¼ìŒ
            studentsArray.forEach((student, index) => {
                const newRank = index + 1;
                const oldRank = previousRankings[student.name];
                
                if (oldRank && oldRank !== newRank) {
                    if (newRank < oldRank) {
                        playRankUpSound();
                    } else if (newRank > oldRank) {
                        playRankDownSound();
                    }
                }
                
                previousRankings[student.name] = newRank;
            });

            // ìˆœìœ„í‘œ ë Œë”ë§
            const rankingGrid = document.getElementById('rankingGrid');
            rankingGrid.innerHTML = '';

            studentsArray.forEach((student, index) => {
                const rank = index + 1;
                const oldRank = previousRankings[student.name];
                const rankChange = oldRank ? oldRank - rank : 0;

                const card = document.createElement('div');
                card.className = `rank-card rank-${rank <= 3 ? rank : 'other'}`;
                
                // ìˆœìœ„ ë³€ë™ ì• ë‹ˆë©”ì´ì…˜
                if (rankChange > 0) {
                    card.classList.add('moving-up');
                } else if (rankChange < 0) {
                    card.classList.add('moving-down');
                }

                const medalEmoji = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : rank;
                
                const returnClass = student.returnRate >= 0 ? 'return-positive' : 'return-negative';
                const returnSymbol = student.returnRate >= 0 ? 'â–²' : 'â–¼';

                card.innerHTML = `
                    <div class="rank-badge ${rank > 3 ? 'other' : ''}">${medalEmoji}</div>
                    <div class="student-name">${student.name}</div>
                    <div></div>
                    <div class="stat-item">
                        <div class="stat-item-label">ì´ ìì‚°</div>
                        <div class="stat-item-value">${formatNumber(student.totalAssets)}ì›</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">ë³´ìœ  í˜„ê¸ˆ</div>
                        <div class="stat-item-value">${formatNumber(student.cash)}ì›</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">ì£¼ì‹ ê°€ì¹˜</div>
                        <div class="stat-item-value">${formatNumber(student.stockValue)}ì›</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">ìˆ˜ìµë¥ </div>
                        <div class="stat-item-value ${returnClass}">${returnSymbol} ${Math.abs(student.returnRate).toFixed(2)}%</div>
                    </div>
                `;

                // ìˆœìœ„ ë³€ë™ í‘œì‹œ
                if (rankChange !== 0) {
                    const indicator = document.createElement('div');
                    indicator.className = `rank-change-indicator ${rankChange > 0 ? 'rank-up' : 'rank-down'}`;
                    indicator.textContent = rankChange > 0 ? 'â†‘' : 'â†“';
                    card.querySelector('.rank-badge').appendChild(indicator);
                }

                rankingGrid.appendChild(card);
            });
        }

        function updateStats(studentsArray) {
            if (!studentsArray || studentsArray.length === 0) {
                document.getElementById('totalStudents').textContent = '0';
                document.getElementById('topReturn').textContent = '0%';
                document.getElementById('avgAssets').textContent = '0ì›';
                document.getElementById('avgReturn').textContent = '0%';
                return;
            }

            const totalStudents = studentsArray.length;
            const topReturn = studentsArray[0]?.returnRate || 0;
            const avgAssets = Math.floor(
                studentsArray.reduce((sum, s) => sum + s.totalAssets, 0) / totalStudents
            );
            const avgReturn = (
                studentsArray.reduce((sum, s) => sum + s.returnRate, 0) / totalStudents
            ).toFixed(2);

            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('topReturn').textContent = topReturn.toFixed(2) + '%';
            document.getElementById('avgAssets').textContent = formatNumber(avgAssets) + 'ì›';
            document.getElementById('avgReturn').textContent = avgReturn + '%';
        }

        function updateRefreshIndicator() {
            const indicator = document.getElementById('refreshIndicator');
            indicator.textContent = `âœ“ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString('ko-KR')}`;
            indicator.classList.add('active');
            
            setTimeout(() => {
                indicator.classList.remove('active');
            }, 1000);
        }

        function showError(message) {
            const rankingGrid = document.getElementById('rankingGrid');
            rankingGrid.innerHTML = `
                <div class="no-data" style="color: #e74c3c;">
                    âš ï¸ ${message}
                </div>
            `;
        }

        function formatNumber(num) {
            return num.toLocaleString('ko-KR');
        }

        // ì „ì²´ ë°ì´í„° ì´ˆê¸°í™” í•¨ìˆ˜
        async function resetAllData() {
            if (!confirm('âš ï¸ ì •ë§ ëª¨ë“  í•™ìƒ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }
            
            if (!confirm('âš ï¸âš ï¸ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•©ë‹ˆë‹¤.\nì •ë§ë¡œ ì „ì²´ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                if (!window.firebaseDB || !window.firebaseRef || !window.firebaseRemove) {
                    alert('âŒ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nFirebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const studentsRef = window.firebaseRef(window.firebaseDB, 'students');
                await window.firebaseRemove(studentsRef);
                
                alert('âœ… ëª¨ë“  í•™ìƒ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\ní•™ìƒë“¤ì´ ë‹¤ì‹œ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                
                // í™”ë©´ ì´ˆê¸°í™”
                document.getElementById('rankingGrid').innerHTML = `
                    <div class="no-data">
                        í•™ìƒë“¤ì´ ê²Œì„ì— ì°¸ì—¬í•˜ë©´ ì—¬ê¸°ì— ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤! ğŸ®
                    </div>
                `;
                
                updateStats(null);
                document.getElementById('refreshIndicator').textContent = 'ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ëŒ€ê¸° ì¤‘...';
                
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('âŒ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n' + error.message);
            }
        }
        
        // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ window ê°ì²´ì— í• ë‹¹
        window.resetAllData = resetAllData;
    </script>
</body>
</html>