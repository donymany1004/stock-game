<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ˆ íˆ¬ì ì²œì¬ë¥¼ ì°¾ì•„ë¼! - í•™ìƒìš©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .student-name-display {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .name-input-modal {
            display: flex;
            background: rgba(0,0,0,0.9);
        }

        .name-input-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
        }

        .name-input-content h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .name-input-content p {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .game-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .info-box {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .info-value.positive {
            color: #e74c3c;
        }

        .info-value.negative {
            color: #3498db;
        }

        .news-section {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 120px;
            position: relative;
        }

        .news-section.flash {
            animation: newsFlash 0.5s;
        }

        @keyframes newsFlash {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(255, 193, 7, 0.8); }
        }

        .news-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .news-content {
            font-size: 1.15em;
            color: #533f03;
            line-height: 1.8;
        }

        .news-timer {
            background: #f39c12;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .stock-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            max-height: 700px;
            overflow-y: auto;
        }

        .sector {
            margin-bottom: 20px;
        }

        .sector-title {
            background: #667eea;
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sector-title.us-stock {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        .stock-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stock-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .stock-info {
            flex: 1;
        }

        .stock-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .stock-price {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .stock-price-usd {
            font-size: 0.9em;
            color: #666;
            margin-left: 10px;
        }

        .stock-change {
            font-size: 0.9em;
            margin-left: 10px;
            padding: 3px 8px;
            border-radius: 5px;
        }

        .stock-change.up {
            background: #fee;
            color: #e74c3c;
        }

        .stock-change.down {
            background: #e3f2fd;
            color: #3498db;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .btn-buy {
            background: #e74c3c;
            color: white;
        }

        .btn-buy:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .btn-sell {
            background: #3498db;
            color: white;
        }

        .btn-sell:hover {
            background: #2980b9;
            transform: scale(1.05);
        }

        .portfolio {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .portfolio-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .portfolio-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .portfolio-item:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }

        .btn-confirm {
            background: #27ae60;
            color: white;
            padding: 12px 30px;
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
            padding: 12px 30px;
        }

        .delisted {
            opacity: 0.5;
            background: #e0e0e0 !important;
        }

        .us-badge {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 5px;
        }

        .credit {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 0.75em;
            color: #999;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .reset-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            transition: all 0.3s;
            z-index: 1001;
        }

        .reset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .reset-button:active {
            transform: translateY(0);
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ë¦¬ì…‹ ë²„íŠ¼ -->
    <button class="reset-button" onclick="resetGame()">ğŸ”„ ê²Œì„ ì´ˆê¸°í™”</button>

    <div class="container">
        <div class="header">
            <h1>ğŸ“ˆ íˆ¬ì ì²œì¬ë¥¼ ì°¾ì•„ë¼! ğŸ’°</h1>
            <p>êµ­ë‚´ + ë¯¸êµ­ ì£¼ì‹ìœ¼ë¡œ ê¸€ë¡œë²Œ íˆ¬ì ì²´í—˜!</p>
            <div class="student-name-display">ğŸ‘¤ <span id="studentNameDisplay"></span></div>
        </div>

        <div class="game-info">
            <div class="info-box">
                <div class="info-label">â° ë‚¨ì€ ì‹œê°„</div>
                <div class="info-value" id="timer">20:00</div>
            </div>
            <div class="info-box">
                <div class="info-label">ğŸ’µ ë³´ìœ  í˜„ê¸ˆ</div>
                <div class="info-value" id="cash">10,000,000ì›</div>
            </div>
            <div class="info-box">
                <div class="info-label">ğŸ“Š ì£¼ì‹ ê°€ì¹˜</div>
                <div class="info-value" id="stockValue">0ì›</div>
            </div>
            <div class="info-box">
                <div class="info-label">ğŸ’ ì´ ìì‚°</div>
                <div class="info-value" id="totalAssets">10,000,000ì›</div>
            </div>
            <div class="info-box">
                <div class="info-label">ğŸ“ˆ ìˆ˜ìµë¥ </div>
                <div class="info-value" id="returnRate">0%</div>
            </div>
            <div class="info-box">
                <div class="info-label">ğŸ’± í™˜ìœ¨</div>
                <div class="info-value" id="exchangeRate">1,300ì›/$</div>
            </div>
        </div>

        <div class="news-section" id="newsSection">
            <div class="news-title">
                <span id="newsIcon">ğŸ“°</span> 
                <span id="newsLabel">ìµœì‹  ë‰´ìŠ¤</span>
                <span class="news-timer" id="newsTimer" style="display: none;"></span>
            </div>
            <div class="news-content" id="newsContent">ê²Œì„ ì‹œì‘ í›„ 1ë¶„ ë™ì•ˆ íˆ¬ìí•  ì¢…ëª©ì„ ì„ íƒí•˜ì„¸ìš”! 1ë¶„ í›„ë¶€í„° ë‰´ìŠ¤ê°€ ë°œìƒí•©ë‹ˆë‹¤.</div>
        </div>

        <div class="main-content">
            <div class="stock-list" id="stockList"></div>
            
            <div class="portfolio">
                <div class="portfolio-title">ğŸ“‚ ë‚´ ë³´ìœ  ì£¼ì‹</div>
                <div id="portfolioList">
                    <p style="text-align: center; color: #999;">ì•„ì§ ë³´ìœ í•œ ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ì´ë¦„ ì…ë ¥ ëª¨ë‹¬ -->
    <div class="modal name-input-modal" id="nameInputModal">
        <div class="modal-content name-input-content">
            <h2>ğŸ® ê²Œì„ ì‹œì‘!</h2>
            <p>ì—¬ëŸ¬ë¶„ì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.<br>ì„ ìƒë‹˜ í™”ë©´ì— ì‹¤ì‹œê°„ ìˆœìœ„ê°€ í‘œì‹œë©ë‹ˆë‹¤!</p>
            <input type="text" class="modal-input" id="studentNameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10">
            <button class="btn btn-confirm" onclick="startGameWithName()" style="width: 100%;">ê²Œì„ ì‹œì‘í•˜ê¸°!</button>
        </div>
    </div>

    <!-- ê±°ë˜ ëª¨ë‹¬ -->
    <div class="modal" id="tradeModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle"></div>
            <div id="modalInfo" style="margin-bottom: 15px; color: #666;"></div>
            <input type="number" class="modal-input" id="tradeAmount" placeholder="ìˆ˜ëŸ‰ ì…ë ¥" min="1">
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-confirm" onclick="confirmTrade()">í™•ì¸</button>
                <button class="btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- í¬ë ˆë”§ -->
    <div class="credit">Created by ê°€ì‚¬ë¬¸í•™ì´ˆ ìœ¤ì¤€ì² </div>

    <script>
        const INITIAL_CASH = 10000000;
        const GAME_DURATION = 20 * 60;
        const NEWS_INTERVAL = 60;
        const NEWS_DELAY = 30; // ë‰´ìŠ¤ ë°œìƒ í›„ 30ì´ˆ ë’¤ ë°˜ì˜
        const FIRST_NEWS_TIME = 60; // ê²Œì„ ì‹œì‘ 1ë¶„ í›„ ì²« ë‰´ìŠ¤
        const TRANSACTION_FEE = 0.03;
        const INITIAL_EXCHANGE_RATE = 1300;

        let gameState = {
            studentName: '',
            cash: INITIAL_CASH,
            portfolio: {},
            timeRemaining: GAME_DURATION,
            stocks: [],
            currentTrade: null,
            recentNews: [],
            exchangeRate: INITIAL_EXCHANGE_RATE,
            pendingNews: null, // 30ì´ˆ í›„ ì ìš©ë  ë‰´ìŠ¤
            newsDelayTimer: null,
            firstNewsShown: false,
            gameStarted: false
        };

        let timers = {
            game: null,
            news: null
        };

        // íš¨ê³¼ìŒ ì‹œìŠ¤í…œ
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(frequency, duration, type = 'sine') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playNewsSound() {
            // ë‰´ìŠ¤ ì•Œë¦¼ìŒ (ë ë¦¬ë§~)
            playSound(800, 0.1);
            setTimeout(() => playSound(1000, 0.1), 100);
            setTimeout(() => playSound(1200, 0.15), 200);
        }

        function playBuySound() {
            // ë§¤ìˆ˜ íš¨ê³¼ìŒ
            playSound(523, 0.1); // ë„
            setTimeout(() => playSound(659, 0.15), 100); // ë¯¸
        }

        function playSellSound() {
            // ë§¤ë„ íš¨ê³¼ìŒ
            playSound(659, 0.1); // ë¯¸
            setTimeout(() => playSound(523, 0.15), 100); // ë„
        }

        // ìŒì„± ì‹œìŠ¤í…œ (TTS)
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                window.speechSynthesis.speak(utterance);
            }
        }

        // ì„¹í„°ë³„ ê¸°ì—…
        const sectors = {
            'ğŸ” ì‹í’ˆ': ['ì˜¤ë¦¬ì˜¨', 'ë†ì‹¬', 'CJì œì¼ì œë‹¹', 'ë¡¯ë°ì œê³¼', 'ë¹™ê·¸ë ˆ'],
            'ğŸ’» IT/ì „ì': ['ì‚¼ì„±ì „ì', 'LGì „ì', 'SKí•˜ì´ë‹‰ìŠ¤', 'ë„¤ì´ë²„', 'ì¹´ì¹´ì˜¤'],
            'ğŸš— ìë™ì°¨': ['í˜„ëŒ€ìë™ì°¨', 'ê¸°ì•„', 'í˜„ëŒ€ëª¨ë¹„ìŠ¤'],
            'ğŸ¦ ê¸ˆìœµ': ['KBê¸ˆìœµ', 'ì‹ í•œì§€ì£¼', 'í•˜ë‚˜ê¸ˆìœµì§€ì£¼'],
            'ğŸ’„ í™”ì¥í’ˆ': ['ì•„ëª¨ë ˆí¼ì‹œí”½', 'LGìƒí™œê±´ê°•'],
            'ğŸ® ê²Œì„': ['ë„¥ìŠ¨', 'ì—”ì”¨ì†Œí”„íŠ¸', 'ë„·ë§ˆë¸”'],
            'ğŸ—ï¸ ê±´ì„¤': ['ì‚¼ì„±ë¬¼ì‚°', 'í˜„ëŒ€ê±´ì„¤'],
            'ğŸ’Š ì œì•½': ['ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤', 'ì…€íŠ¸ë¦¬ì˜¨'],
            'ğŸ¬ ì—”í„°': ['í•˜ì´ë¸Œ', 'SMì—”í„°', 'JYPì—”í„°'],
            'ğŸ›’ ìœ í†µ': ['ì‹ ì„¸ê³„', 'ë¡¯ë°ì‡¼í•‘', 'ì¿ íŒ¡'],
            'ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì£¼ì‹': [
                'NVIDIA (ì—”ë¹„ë””ì•„)',
                'Apple (ì• í”Œ)', 
                'Microsoft (ë§ˆì´í¬ë¡œì†Œí”„íŠ¸)',
                'Google (êµ¬ê¸€)',
                'Tesla (í…ŒìŠ¬ë¼)',
                'Amazon (ì•„ë§ˆì¡´)',
                'Meta (ë©”íƒ€)',
                'Netflix (ë„·í”Œë¦­ìŠ¤)',
                'AMD',
                'Intel (ì¸í…”)'
            ]
        };

        // ë‰´ìŠ¤ ë°ì´í„° (ê¸°ì¡´ + ê±°ì‹œê²½ì œ/ì •ì¹˜ ì¶”ê°€)
        const sectorNews = [
            {
                sector: 'ì „ì²´',
                news: [
                    'ë¯¸êµ­ ì—°ë°©ì¤€ë¹„ì œë„(Fed)ê°€ ê¸ˆë¦¬ë¥¼ 0.5% ì¸ìƒí–ˆìŠµë‹ˆë‹¤. ì¸í”Œë ˆì´ì…˜ ì–µì œë¥¼ ìœ„í•œ ê¸´ì¶• ì •ì±…ìœ¼ë¡œ ì „ ì„¸ê³„ ì¦ì‹œê°€ ë™ë°˜ í•˜ë½í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ë¯¸êµ­ ëŒ€í†µë ¹ì´ ì¤‘êµ­ê³¼ì˜ ë¬´ì—­ ê´€ì„¸ë¥¼ ëŒ€í­ ì¸í•˜í•˜ê¸°ë¡œ í•©ì˜í–ˆìŠµë‹ˆë‹¤. ê¸€ë¡œë²Œ êµì—­ í™•ëŒ€ ê¸°ëŒ€ê°ì— ìˆ˜ì¶œ ê¸°ì—…ë“¤ì˜ ì£¼ê°€ê°€ ê¸‰ë“±í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ì¤‘ë™ ì§€ì—­ì—ì„œ êµ°ì‚¬ì  ê¸´ì¥ì´ ê³ ì¡°ë˜ê³  ìˆìŠµë‹ˆë‹¤. êµ­ì œ ìœ ê°€ê°€ ê¸‰ë“±í•˜ë©° í•­ê³µÂ·ë¬¼ë¥˜ ì—…ì¢…ì€ í•˜ë½, ì •ìœ  ì—…ì¢…ì€ ìƒìŠ¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ì¼ë³¸ ì—”í™” ê°€ì¹˜ê°€ ê¸‰ë½í•˜ë©° 1ë‹¬ëŸ¬ë‹¹ 150ì—”ì„ ëŒíŒŒí–ˆìŠµë‹ˆë‹¤. í•œêµ­ ìˆ˜ì¶œ ê¸°ì—…ë“¤ì˜ ê°€ê²© ê²½ìŸë ¥ì´ ì•½í™”ë˜ë©° ì „ìÂ·ìë™ì°¨ ì—…ì¢…ì´ í•˜ë½í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ìœ ëŸ½ì—°í•©ì´ íƒ„ì†Œ ë°°ì¶œê¶Œ ê°€ê²©ì„ 2ë°°ë¡œ ì¸ìƒí–ˆìŠµë‹ˆë‹¤. ì¹œí™˜ê²½ ê¸°ìˆ  ê¸°ì—…ë“¤ì€ ìˆ˜í˜œë¥¼ ì…ì§€ë§Œ ì² ê°•Â·í™”í•™ ë“± ì „í†µ ì œì¡°ì—…ì€ ë¶€ë‹´ì´ ì»¤ì§€ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ë¯¸êµ­ ì‹¤ë¦¬ì½˜ë°¸ë¦¬ì€í–‰(SVB)ì´ íŒŒì‚°í–ˆìŠµë‹ˆë‹¤. ê¸ˆìœµê¶Œ ë¶ˆì•ˆì´ í™•ì‚°ë˜ë©° ì „ ì„¸ê³„ ì€í–‰ì£¼ê°€ ì¼ì œíˆ í­ë½í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'í•œêµ­ ì •ë¶€ê°€ ë°˜ë„ì²´ ì‚°ì—…ì— 10ì¡°ì› ê·œëª¨ì˜ ì§€ì›ì„ ë°œí‘œí–ˆìŠµë‹ˆë‹¤. êµ­ê°€ ì „ëµ ì‚°ì—… ìœ¡ì„± ì •ì±…ìœ¼ë¡œ ë°˜ë„ì²´ ê´€ë ¨ì£¼ê°€ ê°•ì„¸ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ë¶í•œì´ ë¯¸ì‚¬ì¼ì„ ë°œì‚¬í•˜ë©° í•œë°˜ë„ ê¸´ì¥ì´ ê³ ì¡°ë˜ì—ˆìŠµë‹ˆë‹¤. ì•ˆì „ìì‚° ì„ í˜¸ í˜„ìƒìœ¼ë¡œ ê¸ˆê°’ì€ ìƒìŠ¹í•˜ê³  ì£¼ì‹ì‹œì¥ì€ ì „ë°˜ì ìœ¼ë¡œ ì•½ì„¸ì…ë‹ˆë‹¤.',
                    'ì¤‘êµ­ì´ ì œë¡œ ì½”ë¡œë‚˜ ì •ì±…ì„ ì „ê²© í•´ì œí–ˆìŠµë‹ˆë‹¤. ê²½ê¸° íšŒë³µ ê¸°ëŒ€ê°ì— ì¤‘êµ­ ì˜ì¡´ë„ê°€ ë†’ì€ í™”ì¥í’ˆÂ·ê´€ê´‘ ì—…ì¢…ì´ ê¸‰ë“±í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ë¯¸êµ­ ì˜íšŒê°€ ì¸í”„ë¼ íˆ¬ì ë²•ì•ˆì„ í†µê³¼ì‹œì¼°ìŠµë‹ˆë‹¤. 5000ì–µ ë‹¬ëŸ¬ ê·œëª¨ì˜ ì¸í”„ë¼ íˆ¬ìë¡œ ê±´ì„¤Â·ì² ê°•Â·ì‹œë©˜íŠ¸ ì—…ì¢…ì— í˜¸ì¬ì…ë‹ˆë‹¤.'
                ],
                impact: [-0.15, 0.18, -0.12, -0.10, -0.08, -0.20, 0.15, -0.12, 0.20, 0.12]
            },
            {
                sector: 'IT/ì „ì',
                news: [
                    'AI ë°˜ë„ì²´ ìˆ˜ìš”ê°€ í­ë°œì ìœ¼ë¡œ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ChatGPT ë“± ìƒì„±í˜• AI í™•ì‚°ìœ¼ë¡œ ê³ ì„±ëŠ¥ GPUì™€ ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì£¼ë¬¸ì´ ê¸‰ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ê¸€ë¡œë²Œ ë°˜ë„ì²´ ê°€ê²©ì´ 30% ê¸‰ë½í–ˆìŠµë‹ˆë‹¤. PCÂ·ìŠ¤ë§ˆíŠ¸í° ìˆ˜ìš” ê°ì†Œì™€ ì¬ê³  ê³¼ì‰ìœ¼ë¡œ ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì—…í™©ì´ í¬ê²Œ ì•…í™”ë˜ì—ˆìŠµë‹ˆë‹¤.',
                    'í€€í…€ë‹· ë””ìŠ¤í”Œë ˆì´ ê¸°ìˆ ì´ ìƒìš©í™”ë©ë‹ˆë‹¤. ì°¨ì„¸ëŒ€ ë””ìŠ¤í”Œë ˆì´ ì‹œì¥ì„ ì„ ì í•œ ê¸°ì—…ë“¤ì˜ ê²½ìŸë ¥ì´ ë†’ì•„ì§€ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                impact: [0.25, -0.22, 0.18]
            },
            {
                sector: 'ìë™ì°¨',
                news: [
                    'ìœ ëŸ½ì—°í•©ì´ 2030ë…„ë¶€í„° ë‚´ì—°ê¸°ê´€ì°¨ íŒë§¤ë¥¼ ì „ë©´ ê¸ˆì§€í•©ë‹ˆë‹¤. ì „ê¸°ì°¨ ì „í™˜ì´ ê°€ì†í™”ë˜ë©° ì „ê¸°ì°¨ ì—…ì²´ë“¤ì˜ ì£¼ê°€ê°€ ê¸‰ë“±í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ë¯¸êµ­ì´ ìêµ­ì‚° ì „ê¸°ì°¨ì—ë§Œ ë³´ì¡°ê¸ˆì„ ì§€ê¸‰í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. í•œêµ­ì‚° ì „ê¸°ì°¨ëŠ” í˜œíƒì—ì„œ ì œì™¸ë˜ì–´ íŒë§¤ ê°ì†Œê°€ ìš°ë ¤ë©ë‹ˆë‹¤.'
                ],
                impact: [0.20, -0.18]
            },
            {
                sector: 'ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì£¼ì‹',
                news: [
                    'ì—”ë¹„ë””ì•„ê°€ ì°¨ì„¸ëŒ€ AIì¹©ì„ ê³µê°œí–ˆìŠµë‹ˆë‹¤. ì„±ëŠ¥ì´ ê¸°ì¡´ ëŒ€ë¹„ 10ë°° í–¥ìƒë˜ë©° AI ì—…ê³„ë¥¼ ì„ ë„í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ì• í”Œì´ ì‹ í˜• ì•„ì´í° ì‚¬ì „ì˜ˆì•½ì—ì„œ ì—­ëŒ€ ìµœê³  ê¸°ë¡ì„ ê²½ì‹ í–ˆìŠµë‹ˆë‹¤. í”„ë¦¬ë¯¸ì—„ ìŠ¤ë§ˆíŠ¸í° ì‹œì¥ì—ì„œ ë…ë³´ì  ìœ„ì¹˜ë¥¼ ê³µê³ íˆ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'í…ŒìŠ¬ë¼ CEOê°€ ë…¼ë€ì´ ë˜ëŠ” ë°œì–¸ìœ¼ë¡œ ì£¼ê°€ê°€ ê¸‰ë½í–ˆìŠµë‹ˆë‹¤. ê²½ì˜ ë¶ˆí™•ì‹¤ì„±ì— íˆ¬ììë“¤ì´ ìš°ë ¤ë¥¼ í‘œí•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'êµ¬ê¸€ì´ ë°˜ë…ì  ì†Œì†¡ì—ì„œ íŒ¨ì†Œí–ˆìŠµë‹ˆë‹¤. ê±°ì•¡ì˜ ë²Œê¸ˆê³¼ ì‚¬ì—… êµ¬ì¡° ê°œí¸ì´ ì˜ˆìƒë˜ë©° ì£¼ê°€ê°€ í•˜ë½í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    'ì•„ë§ˆì¡´ì˜ ë¶„ê¸° ì‹¤ì ì´ ì‹œì¥ ì˜ˆìƒì„ í¬ê²Œ ìƒíšŒí–ˆìŠµë‹ˆë‹¤. í´ë¼ìš°ë“œ ì‚¬ì—… AWSì˜ ì„±ì¥ì„¸ê°€ ì§€ì†ë˜ë©° í˜¸ì‹¤ì ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.'
                ],
                impact: [0.30, 0.20, -0.25, -0.18, 0.22]
            }
        ];

        // ê°œë³„ ì¢…ëª© ë‰´ìŠ¤
        const companyNews = [
            { company: 'ì‚¼ì„±ì „ì', news: 'ì‚¼ì„±ì „ìê°€ 3ë‚˜ë…¸ ë°˜ë„ì²´ ì–‘ì‚°ì— ì„¸ê³„ ìµœì´ˆë¡œ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.', impact: 0.25 },
            { company: 'NVIDIA (ì—”ë¹„ë””ì•„)', news: 'ì—”ë¹„ë””ì•„ê°€ AI ë°ì´í„°ì„¼í„° ë§¤ì¶œ 200% ì¦ê°€ë¥¼ ë°œí‘œí–ˆìŠµë‹ˆë‹¤.', impact: 0.35 },
            { company: 'Apple (ì• í”Œ)', news: 'ì• í”Œì´ AR ê¸€ë˜ìŠ¤ ì¶œì‹œë¥¼ ë°œí‘œí•˜ë©° ìƒˆë¡œìš´ ì‹œì¥ì„ ê°œì²™í•©ë‹ˆë‹¤.', impact: 0.28 },
            { company: 'Tesla (í…ŒìŠ¬ë¼)', news: 'í…ŒìŠ¬ë¼ê°€ ì™„ì „ììœ¨ì£¼í–‰ ê¸°ìˆ  ìƒìš©í™”ë¥¼ ì•ë‹¹ê¹ë‹ˆë‹¤.', impact: 0.30 },
            { company: 'Microsoft (ë§ˆì´í¬ë¡œì†Œí”„íŠ¸)', news: 'ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ì˜ í´ë¼ìš°ë“œ ë¶€ë¬¸ì´ ì—­ëŒ€ ìµœê³  ì‹¤ì ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.', impact: 0.25 }
        ];

        function initGame() {
            let stockId = 0;
            gameState.stocks = [];
            gameState.recentNews = [];
            
            const marketMood = Math.random();
            
            for (let [sector, companies] of Object.entries(sectors)) {
                for (let company of companies) {
                    const isUSStock = sector.includes('ğŸ‡ºğŸ‡¸');
                    const priceVariation = 0.7 + (Math.random() * 0.6);
                    
                    let basePrice;
                    if (isUSStock) {
                        // ë¯¸êµ­ ì£¼ì‹: 100~500 ë‹¬ëŸ¬
                        basePrice = Math.floor((100 + Math.random() * 400) * priceVariation);
                    } else {
                        // í•œêµ­ ì£¼ì‹
                        basePrice = Math.floor((30000 + Math.random() * 220000) * priceVariation);
                    }
                    
                    gameState.stocks.push({
                        id: stockId++,
                        name: company,
                        sector: sector,
                        price: basePrice,
                        initialPrice: basePrice,
                        change: 0,
                        delisted: false,
                        isUSStock: isUSStock
                    });
                }
            }
            
            renderStocks();
            startTimer();
            scheduleFirstNews();
        }

        function scheduleFirstNews() {
            // 60ì´ˆ í›„ ì²« ë‰´ìŠ¤ ë°œìƒ
            setTimeout(() => {
                gameState.firstNewsShown = true;
                generateNews();
                // ì´í›„ 60ì´ˆë§ˆë‹¤ ë‰´ìŠ¤ ë°œìƒ
                timers.news = setInterval(generateNews, NEWS_INTERVAL * 1000);
            }, FIRST_NEWS_TIME * 1000);
        }

        function generateNews() {
            const MAX_RECENT_NEWS = 7;
            let attempts = 0;
            let news, baseImpact, affectedSector, affectedCompany, newsKey;
            
            do {
                attempts++;
                const useCompanyNews = Math.random() < 0.3;
                
                if (useCompanyNews && companyNews.length > 0) {
                    const newsItem = companyNews[Math.floor(Math.random() * companyNews.length)];
                    news = newsItem.news;
                    affectedCompany = newsItem.company;
                    baseImpact = newsItem.impact;
                    affectedSector = null;
                    newsKey = `company_${affectedCompany}_${news.substring(0, 30)}`;
                } else {
                    const template = sectorNews[Math.floor(Math.random() * sectorNews.length)];
                    const newsIndex = Math.floor(Math.random() * template.news.length);
                    news = template.news[newsIndex];
                    baseImpact = template.impact[newsIndex];
                    affectedSector = template.sector;
                    affectedCompany = null;
                    newsKey = `sector_${affectedSector}_${news.substring(0, 30)}`;
                }
                
                if (attempts >= 20) break;
                
            } while (gameState.recentNews.includes(newsKey));
            
            gameState.recentNews.push(newsKey);
            if (gameState.recentNews.length > MAX_RECENT_NEWS) {
                gameState.recentNews.shift();
            }
            
            // ë‰´ìŠ¤ í‘œì‹œ
            playNewsSound(); // íš¨ê³¼ìŒ
            
            const newsSection = document.getElementById('newsSection');
            newsSection.classList.add('flash');
            setTimeout(() => newsSection.classList.remove('flash'), 500);
            
            document.getElementById('newsContent').textContent = news;
            document.getElementById('newsLabel').textContent = 'ğŸš¨ ì†ë³´ ë°œìƒ!';
            
            // 30ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            startNewsCountdown(news, baseImpact, affectedSector, affectedCompany);
        }

        function startNewsCountdown(news, baseImpact, affectedSector, affectedCompany) {
            let countdown = NEWS_DELAY;
            const timerElement = document.getElementById('newsTimer');
            timerElement.style.display = 'block';
            timerElement.textContent = `ì‹œì„¸ ë°˜ì˜ê¹Œì§€ ${countdown}ì´ˆ`;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                timerElement.textContent = `ì‹œì„¸ ë°˜ì˜ê¹Œì§€ ${countdown}ì´ˆ`;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    timerElement.style.display = 'none';
                    document.getElementById('newsLabel').textContent = 'ìµœì‹  ë‰´ìŠ¤';
                    applyNewsEffect(baseImpact, affectedSector, affectedCompany);
                }
            }, 1000);
        }

        function applyNewsEffect(baseImpact, affectedSector, affectedCompany) {
            // í™˜ìœ¨ ë³€ë™ (Â±3%)
            const exchangeChange = (Math.random() * 0.06 - 0.03);
            gameState.exchangeRate = Math.floor(gameState.exchangeRate * (1 + exchangeChange));
            
            for (let stock of gameState.stocks) {
                if (stock.delisted) continue;
                
                let impact = 0;
                
                if (affectedCompany) {
                    if (stock.name === affectedCompany) {
                        impact = baseImpact + (Math.random() * 0.05 - 0.025);
                    } else if (stock.sector === gameState.stocks.find(s => s.name === affectedCompany)?.sector) {
                        impact = baseImpact * 0.3 + (Math.random() * 0.08 - 0.04);
                    } else {
                        impact = (Math.random() * 0.08 - 0.04);
                    }
                } else {
                    if (affectedSector === 'ì „ì²´') {
                        impact = baseImpact + (Math.random() * 0.05 - 0.025);
                    } else if (stock.sector.includes(affectedSector) || 
                               (affectedSector === 'ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì£¼ì‹' && stock.isUSStock)) {
                        impact = baseImpact + (Math.random() * 0.1 - 0.05);
                    } else {
                        impact = (Math.random() * 0.1 - 0.05);
                    }
                }
                
                impact = Math.max(-0.30, Math.min(0.30, impact));
                stock.price = Math.max(stock.isUSStock ? 10 : 1000, Math.floor(stock.price * (1 + impact)));
                stock.change = impact;
            }
            
            renderStocks();
            updateDisplay();
        }

        function renderStocks() {
            const stockList = document.getElementById('stockList');
            stockList.innerHTML = '';
            
            const groupedStocks = {};
            for (let stock of gameState.stocks) {
                if (!groupedStocks[stock.sector]) {
                    groupedStocks[stock.sector] = [];
                }
                groupedStocks[stock.sector].push(stock);
            }
            
            for (let [sector, stocks] of Object.entries(groupedStocks)) {
                const sectorDiv = document.createElement('div');
                sectorDiv.className = 'sector';
                
                const isUSStock = sector.includes('ğŸ‡ºğŸ‡¸');
                const sectorTitle = document.createElement('div');
                sectorTitle.className = 'sector-title' + (isUSStock ? ' us-stock' : '');
                sectorTitle.innerHTML = `<span>${sector}</span>`;
                if (isUSStock) {
                    sectorTitle.innerHTML += `<span style="font-size: 0.9em;">1$ = ${formatNumber(gameState.exchangeRate)}ì›</span>`;
                }
                
                sectorDiv.appendChild(sectorTitle);
                
                for (let stock of stocks) {
                    const stockDiv = document.createElement('div');
                    stockDiv.className = 'stock-item' + (stock.delisted ? ' delisted' : '');
                    
                    const changeClass = stock.change >= 0 ? 'up' : 'down';
                    const changeSymbol = stock.change >= 0 ? 'â–²' : 'â–¼';
                    
                    let priceDisplay = '';
                    if (stock.isUSStock) {
                        const wonPrice = stock.price * gameState.exchangeRate;
                        priceDisplay = `<span class="stock-price">$${formatNumber(stock.price)}<span class="stock-price-usd">(${formatNumber(wonPrice)}ì›)</span></span>`;
                    } else {
                        priceDisplay = `<span class="stock-price">${formatNumber(stock.price)}ì›</span>`;
                    }
                    
                    stockDiv.innerHTML = `
                        <div class="stock-info">
                            <div class="stock-name">
                                ${stock.name}
                                ${stock.isUSStock ? '<span class="us-badge">ë¯¸êµ­</span>' : ''}
                            </div>
                            ${priceDisplay}
                            <span class="stock-change ${changeClass}">${changeSymbol} ${(Math.abs(stock.change) * 100).toFixed(2)}%</span>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-buy" onclick="openTrade(${stock.id}, 'buy')" ${stock.delisted ? 'disabled' : ''}>ë§¤ìˆ˜</button>
                            <button class="btn btn-sell" onclick="openTrade(${stock.id}, 'sell')" ${!gameState.portfolio[stock.id] || stock.delisted ? 'disabled' : ''}>ë§¤ë„</button>
                        </div>
                    `;
                    
                    sectorDiv.appendChild(stockDiv);
                }
                
                stockList.appendChild(sectorDiv);
            }
        }

        function openTrade(stockId, type) {
            const stock = gameState.stocks.find(s => s.id === stockId);
            gameState.currentTrade = { stockId, type };
            
            const modal = document.getElementById('tradeModal');
            const title = document.getElementById('modalTitle');
            const info = document.getElementById('modalInfo');
            
            const actualPrice = stock.isUSStock ? stock.price * gameState.exchangeRate : stock.price;
            
            if (type === 'buy') {
                const maxBuy = Math.floor(gameState.cash / actualPrice);
                title.textContent = `${stock.name} ë§¤ìˆ˜`;
                info.innerHTML = `í˜„ì¬ê°€: ${formatNumber(actualPrice)}ì›<br>ìµœëŒ€ ${formatNumber(maxBuy)}ì£¼ êµ¬ë§¤ ê°€ëŠ¥`;
            } else {
                const owned = gameState.portfolio[stockId].amount;
                title.textContent = `${stock.name} ë§¤ë„`;
                info.innerHTML = `í˜„ì¬ê°€: ${formatNumber(actualPrice)}ì›<br>ë³´ìœ : ${formatNumber(owned)}ì£¼`;
            }
            
            document.getElementById('tradeAmount').value = '';
            modal.style.display = 'flex';
            document.getElementById('tradeAmount').focus();
        }

        function confirmTrade() {
            const amount = parseInt(document.getElementById('tradeAmount').value);
            if (!amount || amount <= 0) {
                alert('ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }
            
            const { stockId, type } = gameState.currentTrade;
            const stock = gameState.stocks.find(s => s.id === stockId);
            const actualPrice = stock.isUSStock ? stock.price * gameState.exchangeRate : stock.price;
            
            if (type === 'buy') {
                const cost = Math.floor(actualPrice * amount * (1 + TRANSACTION_FEE));
                if (cost > gameState.cash) {
                    alert('í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
                    return;
                }
                
                gameState.cash -= cost;
                if (!gameState.portfolio[stockId]) {
                    gameState.portfolio[stockId] = { amount: 0, avgPrice: 0 };
                }
                
                const prevTotal = gameState.portfolio[stockId].amount * gameState.portfolio[stockId].avgPrice;
                gameState.portfolio[stockId].amount += amount;
                gameState.portfolio[stockId].avgPrice = (prevTotal + actualPrice * amount) / gameState.portfolio[stockId].amount;
                
                // ë§¤ìˆ˜ íš¨ê³¼ìŒ ë° ìŒì„±
                playBuySound();
                speak('ë§¤ìˆ˜í–ˆìŠµë‹ˆë‹¤');
                
            } else {
                if (!gameState.portfolio[stockId] || gameState.portfolio[stockId].amount < amount) {
                    alert('ë³´ìœ  ìˆ˜ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
                    return;
                }
                
                const revenue = Math.floor(actualPrice * amount * (1 - TRANSACTION_FEE));
                gameState.cash += revenue;
                gameState.portfolio[stockId].amount -= amount;
                
                if (gameState.portfolio[stockId].amount === 0) {
                    delete gameState.portfolio[stockId];
                }
                
                // ë§¤ë„ íš¨ê³¼ìŒ ë° ìŒì„±
                playSellSound();
                speak('ë§¤ë„í–ˆìŠµë‹ˆë‹¤');
            }
            
            closeModal();
            updateDisplay();
            renderPortfolio();
        }

        function closeModal() {
            document.getElementById('tradeModal').style.display = 'none';
            gameState.currentTrade = null;
        }

        function calculateStockValue() {
            let total = 0;
            for (let [stockId, holding] of Object.entries(gameState.portfolio)) {
                const stock = gameState.stocks.find(s => s.id === parseInt(stockId));
                if (stock && !stock.delisted) {
                    const actualPrice = stock.isUSStock ? stock.price * gameState.exchangeRate : stock.price;
                    total += actualPrice * holding.amount;
                }
            }
            return Math.floor(total);
        }

        function updateDisplay() {
            document.getElementById('cash').textContent = formatNumber(gameState.cash) + 'ì›';
            document.getElementById('exchangeRate').textContent = formatNumber(gameState.exchangeRate) + 'ì›/$';
            
            const stockValue = calculateStockValue();
            document.getElementById('stockValue').textContent = formatNumber(stockValue) + 'ì›';
            
            const totalAssets = gameState.cash + stockValue;
            document.getElementById('totalAssets').textContent = formatNumber(totalAssets) + 'ì›';
            
            const returnRate = ((totalAssets - INITIAL_CASH) / INITIAL_CASH * 100).toFixed(2);
            const returnElement = document.getElementById('returnRate');
            returnElement.textContent = returnRate + '%';
            returnElement.className = 'info-value ' + (returnRate >= 0 ? 'positive' : 'negative');
            
            // Firebase ì—…ë°ì´íŠ¸
            updateFirebase();
        }

        function renderPortfolio() {
            const list = document.getElementById('portfolioList');
            
            if (Object.keys(gameState.portfolio).length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #999;">ì•„ì§ ë³´ìœ í•œ ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            list.innerHTML = '';
            for (let [stockId, holding] of Object.entries(gameState.portfolio)) {
                const stock = gameState.stocks.find(s => s.id === parseInt(stockId));
                if (!stock) continue;
                
                const actualPrice = stock.isUSStock ? stock.price * gameState.exchangeRate : stock.price;
                const profitLoss = ((actualPrice - holding.avgPrice) / holding.avgPrice * 100).toFixed(2);
                const profitClass = profitLoss >= 0 ? 'positive' : 'negative';
                
                const div = document.createElement('div');
                div.className = 'portfolio-item';
                div.onclick = () => openTrade(parseInt(stockId), 'sell');
                div.innerHTML = `
                    <div style="font-weight: bold;">${stock.name}</div>
                    <div style="font-size: 0.9em; color: #666;">
                        ${formatNumber(holding.amount)}ì£¼ | í‰ê·  ${formatNumber(Math.floor(holding.avgPrice))}ì›
                    </div>
                    <div style="font-size: 0.9em; color: #666;">
                        í˜„ì¬ê°€ ${formatNumber(Math.floor(actualPrice))}ì› | 
                        <span class="${profitClass}">${profitLoss}%</span>
                    </div>
                `;
                list.appendChild(div);
            }
        }

        function startTimer() {
            timers.game = setInterval(() => {
                gameState.timeRemaining--;
                
                const minutes = Math.floor(gameState.timeRemaining / 60);
                const seconds = gameState.timeRemaining % 60;
                document.getElementById('timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (gameState.timeRemaining <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            clearInterval(timers.game);
            if (timers.news) clearInterval(timers.news);
            
            const totalAssets = gameState.cash + calculateStockValue();
            const returnRate = ((totalAssets - INITIAL_CASH) / INITIAL_CASH * 100).toFixed(2);
            
            alert(`ê²Œì„ ì¢…ë£Œ!\n\nìµœì¢… ìì‚°: ${formatNumber(totalAssets)}ì›\nìˆ˜ìµë¥ : ${returnRate}%`);
        }

        function formatNumber(num) {
            return num.toLocaleString('ko-KR');
        }

        // Firebase ì´ˆê¸°í™”
        async function initFirebase() {
            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getDatabase, ref, set } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');

                const firebaseConfig = {
  apiKey: "AIzaSyA3yFsHhQg4l_4_75zl6EKydB0ANiuNY8Y",
  authDomain: "stock-game-2025.firebaseapp.com",
  databaseURL: "https://stock-game-2025-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "stock-game-2025",
  storageBucket: "stock-game-2025.firebasestorage.app",
  messagingSenderId: "1006617048802",
  appId: "1:1006617048802:web:f34930b9618236520d90bb"
};

                const app = initializeApp(firebaseConfig);
                window.firebaseDB = getDatabase(app);
                window.firebaseRef = ref;
                window.firebaseSet = set;
                console.log('Firebase ì—°ê²° ì„±ê³µ!');
            } catch (error) {
                console.log('Firebase ì„¤ì • í•„ìš”:', error);
            }
        }

        // Firebaseë¡œ ë°ì´í„° ì „ì†¡
        function updateFirebase() {
            if (!window.firebaseDB || !gameState.studentName || !gameState.gameStarted) return;
            
            const totalAssets = gameState.cash + calculateStockValue();
            const returnRate = ((totalAssets - INITIAL_CASH) / INITIAL_CASH * 100);
            
            const studentData = {
                name: gameState.studentName,
                cash: gameState.cash,
                stockValue: calculateStockValue(),
                totalAssets: totalAssets,
                returnRate: parseFloat(returnRate.toFixed(2)),
                lastUpdate: Date.now()
            };
            
            try {
                const studentRef = window.firebaseRef(window.firebaseDB, 'students/' + gameState.studentName.replace(/[.#$[\]]/g, '_'));
                window.firebaseSet(studentRef, studentData);
            } catch (error) {
                console.log('Firebase ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        // ì´ë¦„ ì…ë ¥ í›„ ê²Œì„ ì‹œì‘
        function startGameWithName() {
            const nameInput = document.getElementById('studentNameInput');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            gameState.studentName = name;
            gameState.gameStarted = true;
            document.getElementById('studentNameDisplay').textContent = name;
            document.getElementById('nameInputModal').style.display = 'none';
            
            initGame();
            updateFirebase(); // ì´ˆê¸° ë°ì´í„° ì „ì†¡
        }

        // ê²Œì„ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetGame() {
            if (!confirm('ì •ë§ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ì§„í–‰ ìƒí™©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤!')) {
                return;
            }
            
            // ëª¨ë“  íƒ€ì´ë¨¸ ì •ë¦¬
            if (timers.game) clearInterval(timers.game);
            if (timers.news) clearInterval(timers.news);
            
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
            gameState.cash = INITIAL_CASH;
            gameState.portfolio = {};
            gameState.timeRemaining = GAME_DURATION;
            gameState.stocks = [];
            gameState.currentTrade = null;
            gameState.recentNews = [];
            gameState.exchangeRate = INITIAL_EXCHANGE_RATE;
            gameState.pendingNews = null;
            gameState.newsDelayTimer = null;
            gameState.firstNewsShown = false;
            gameState.gameStarted = false;
            
            timers.game = null;
            timers.news = null;
            
            // í™”ë©´ ì´ˆê¸°í™”
            document.getElementById('newsContent').textContent = 'ì´ë¦„ì„ ì…ë ¥í•˜ë©´ ê²Œì„ì´ ì‹œì‘ë©ë‹ˆë‹¤...';
            document.getElementById('newsLabel').textContent = 'ìµœì‹  ë‰´ìŠ¤';
            document.getElementById('newsTimer').style.display = 'none';
            
            // ì´ë¦„ ì…ë ¥ ëª¨ë‹¬ ë‹¤ì‹œ í‘œì‹œ
            document.getElementById('nameInputModal').style.display = 'flex';
            document.getElementById('studentNameInput').value = '';
            document.getElementById('studentNameInput').focus();
            document.getElementById('studentNameDisplay').textContent = '';
            
            // ìŒì„± ì•ˆë‚´
            speak('ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.onload = function() {
            document.getElementById('nameInputModal').style.display = 'flex';
            document.getElementById('studentNameInput').focus();
            
            // Enter í‚¤ë¡œ ì‹œì‘
            document.getElementById('studentNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startGameWithName();
                }
            });

            // Firebase ì´ˆê¸°í™”
            initFirebase();
        };
    </script>
</body>
</html>